# 解決浮動 IP 的各種方法整理

當使用 Raspberry Pi、IoT 裝置或伺服器時，浮動 IP 常導致設備無法連線。本文件整理了所有常見的解決方式，並說明適合的情境與建議。

---

## ✅ 方法總覽

| 方法                                               | 說明                                 | 適合對象                   | 是否推薦        |
| -------------------------------------------------- | ------------------------------------ | -------------------------- | --------------- |
| **1. MAC 綁定 IP（DHCP Reservation）**             | 在路由器中將特定 MAC 固定分配一個 IP | 家用裝置、樹莓派、IoT 裝置 | ⭐ 最穩定推薦   |
| **2. 裝置內部設定靜態 IP**                         | 在裝置本身手動寫入固定 IP            | 高階用戶、無法改路由器的人 | ⚠️ 可行但較複雜 |
| **3. 使用 mDNS / Bonjour（如 raspberrypi.local）** | 利用服務名稱連線，不管 IP            | Mac/Linux/支援 mDNS 的設備 | ✅ 輔助推薦     |
| **4. 使用 DDNS（動態 DNS）**                       | 將浮動外網 IP 綁定網域名稱           | 遠端控制需求者             | ✅ 外部訪問推薦 |
| **5. 使用 ZeroTier / Tailscale（虛擬私網）**       | 將裝置拉入固定虛擬網段               | 遠端控制、跨地連線者       | ✅ 安全強力推薦 |

---

## 🔍 各方法詳解

### ✅ 1. MAC 綁定 IP（你已完成）

- 在 Wi-Fi 分享器設定 MAC → IP 保留
- 每次該裝置連線皆分配固定 IP
- **最簡單、最穩定**
- 適合局域網內的各種 IoT 控制、SSH 操作等

---

### ✅ 2. 裝置內部設定靜態 IP

- 修改如 Raspberry Pi 的 `/etc/dhcpcd.conf`
- 缺點：可能會與 DHCP 衝突造成無法連線
- 僅建議在 **無法改路由器** 時使用

---

### ✅ 3. 使用 mDNS（Multicast DNS）

- 支援的系統可用服務名稱取代 IP，例如：
  ```bash
  ping raspberrypi.local
  ssh pi@raspberrypi.local
  ```
- 前提：裝置與電腦需支援 mDNS（MacOS 預設支援，Windows 需安裝 Bonjour）

---

### ✅ 4. 使用 DDNS（Dynamic DNS）

- 浮動外網 IP 自動綁定至網域名稱，例如：
  ```
  yourname.ddns.net
  ```
- 適合從外部網路連回家中的伺服器、監控或樹莓派
- 常見服務：No-IP、DuckDNS、DynDNS
- 路由器多數支援內建設定

---

### ✅ 5. 使用 ZeroTier / Tailscale

- 免設定 port、NAT 穿透、跨網段固定 IP
- 將多個裝置（無論在哪）拉入同一虛擬網路中
- 適合遠端開發、設備跨區控制、IoT 管理
- 提供像 `100.x.x.x` 穩定虛擬 IP
- **強力推薦給有遠端需求的開發者與團隊**

---

## 🧩 推薦搭配方式

| 使用需求                | 建議解法                         |
| ----------------------- | -------------------------------- |
| 局域網內固定 IP         | ✅ MAC/IP 綁定                   |
| 不想記 IP，想用名稱連線 | ✅ mDNS（如 raspberrypi.local）  |
| 從外部連入控制          | ✅ ZeroTier / DDNS               |
| 無法更改路由器          | ✅ 裝置內手動設定靜態 IP（進階） |

---

## 📦 小結

若你只是在家中使用設備，建議最少做到：

- ✅ MAC/IP 綁定
- ✅ 使用 `.local` 名稱連線（mDNS）

若有跨地點、遠端連線需求，再考慮：

- ✅ ZeroTier / Tailscale / DDNS

---

# 使用 MAC 位址避免 IP 浮動

當開發 IoT 專案（如 Raspberry Pi）時，常會遇到設備 IP 位址變動，導致遠端控制失效的問題。本篇整理如何利用 MAC 位址來避免這類問題。

---

## ✅ 基本觀念

| 名稱            | 說明                                                            |
| --------------- | --------------------------------------------------------------- |
| **MAC 位址**    | 每台網卡的唯一硬體編號（固定不變），格式如：`A1:B2:C3:D4:E5:F6` |
| **IP 位址**     | 每次裝置連上網路時由 DHCP 分配的網路位址（可能會變動）          |
| **IP 浮動問題** | 每次開機、重連、重開機，IP 可能變動，導致控制設備失效           |

---

## ✅ 解法：使用 MAC 位址綁定固定 IP（DHCP Reservation）

### 📌 作法：

1. 登入 Wi-Fi 分享器 / 路由器的管理介面
2. 找到「**DHCP**」或「**IP 位址保留（IP Reservation）**」設定
3. 輸入：
   - **MAC address**（要綁定的設備，如 Raspberry Pi）
   - **指定 IP**（例如：192.168.1.100）
4. 儲存設定並重啟設備網路連線

✅ 從此之後，只要該 MAC 位址連線，就會獲得固定的 IP！

---

## ✅ 推薦使用 DHCP 綁定的原因

| 項目         | DHCP 保留（建議） | 手動靜態 IP（裝置內部設定） |
| ------------ | ----------------- | --------------------------- |
| 安全性       | ✅ 不易出錯       | ❌ 可能與 DHCP 衝突         |
| 設定難度     | 中（登入路由器）  | 高（修改系統設定檔）        |
| 移植與通用性 | ✅ 換裝置自動適用 | ❌ 限定單一裝置             |

---

## ✅ 在 Raspberry Pi 查看 MAC 位址

使用以下指令查看 Wi-Fi 模組的 MAC：

```bash
ifconfig wlan0 | grep ether
# 或者
cat /sys/class/net/wlan0/address
```

---

## 🔚 總結

| 問題          | 解決方式                        |
| ------------- | ------------------------------- |
| IP 位址會浮動 | ❌ 單靠 MAC 無法解決            |
| 避免 IP 浮動  | ✅ 在路由器設定 MAC 綁定固定 IP |

建議你在開發 IoT 專案時，盡早設定 DHCP Reservation，確保裝置穩定可控。
