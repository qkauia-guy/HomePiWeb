# 電子鎖獨立測試說明

## 🚀 快速開始

### 1. 快速測試（推薦）

```bash
cd /Users/qkauia/Desktop/HomePiWeb/pi_agent
python3 quick_test.py
```

這個腳本會：

- 測試 gpiozero 是否可用
- 測試伺服馬達 (pin 18) 的轉動
- 測試 LED (pin 23, 22) 的亮滅

### 2. 完整測試

```bash
cd /Users/qkauia/Desktop/HomePiWeb/pi_agent
python3 test_locker.py
```

這個腳本會：

- 測試硬體偵測
- 測試電子鎖模組的完整功能
- 測試開鎖、上鎖、切換功能
- 測試自動上鎖功能

## 🔧 測試前準備

### 1. 確認硬體接線

- **Pin 18**: 伺服馬達控制線（PWM）
- **Pin 23**: 綠燈（開鎖指示）
- **Pin 22**: 紅燈（上鎖指示）
- **Pin 27**: 按鈕（可選）

### 2. 確認軟體環境

```bash
# 檢查 gpiozero 是否安裝
python3 -c "import gpiozero; print('gpiozero 可用')"

# 如果沒有安裝
pip3 install gpiozero
```

### 3. 確認權限

```bash
# 確保有 GPIO 權限
sudo usermod -a -G gpio $USER
# 重新登入後生效
```

## 📊 測試結果解讀

### ✅ 正常結果

```
✅ gpiozero 可用
🔧 測試伺服馬達 (pin 18)...
   設定到 90 度...
   設定到 0 度...
   設定到 180 度...
   回到 90 度...
✅ 伺服馬達測試完成
🔧 測試 LED...
   綠燈亮...
   紅燈亮...
   全部關閉...
✅ LED 測試完成
```

### ❌ 常見錯誤

#### 1. 權限錯誤

```
PermissionError: [Errno 13] Permission denied
```

**解決方法**: 確保用戶在 gpio 群組中

#### 2. 腳位被占用

```
GPIOInUse: pin 18 is already in use
```

**解決方法**: 關閉其他使用該腳位的程式

#### 3. 硬體錯誤

```
RuntimeError: Failed to add edge detection
```

**解決方法**: 檢查硬體接線是否正確

## 🔍 除錯技巧

### 1. 檢查腳位狀態

```bash
# 查看 GPIO 腳位使用情況
gpio readall
```

### 2. 檢查系統日誌

```bash
# 查看系統日誌
dmesg | grep -i gpio
```

### 3. 手動測試腳位

```bash
# 手動控制 GPIO（需要 root 權限）
echo 18 > /sys/class/gpio/export
echo out > /sys/class/gpio/gpio18/direction
echo 1 > /sys/class/gpio/gpio18/value
```

## 📝 注意事項

1. **安全第一**: 測試時注意伺服馬達的轉動範圍
2. **電源穩定**: 確保伺服馬達有足夠的電源供應
3. **接線正確**: 檢查所有接線是否牢固
4. **環境清潔**: 避免在潮濕環境中測試

## 🆘 如果測試失敗

1. **檢查硬體**: 確認所有接線正確
2. **檢查軟體**: 確認 gpiozero 已正確安裝
3. **檢查權限**: 確認用戶有 GPIO 權限
4. **檢查衝突**: 確認沒有其他程式使用相同腳位
5. **查看日誌**: 檢查系統日誌中的錯誤訊息

## 📞 支援

如果遇到問題，請提供：

- 測試腳本的完整輸出
- 系統日誌中的相關錯誤
- 硬體接線照片（如果可能）
- 樹莓派型號和作業系統版本
