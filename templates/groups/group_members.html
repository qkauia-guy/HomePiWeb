{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container my-4">
  <h2 class="glass-title mb-3"> {{ group.name }}</h2>
  {% if ms.user and ms.user.id %}
    <a class="btn btn-sm btn-outline-secondary"
      href="{% url 'member_device_acl' group.id ms.user.id %}">
      裝置使用權
    </a>
  {% endif %}

  <!-- 新增成員表單 - 毛玻璃效果 -->
<div class="glass-card card mb-4">
  <div class="glass-header card-header d-flex justify-content-between align-items-center">
    <span>建立邀請（單一連結，含多台裝置權限）</span>
    <small class="text-muted">受邀者接受後，會依下表逐台建立控制權限。</small>
  </div>
  <div class="glass-body card-body">
    <form method="post" action="{% url 'group_members' group.id %}">
      {% csrf_token %}

      <div class="row g-3">
        <div class="col-md-4">
          <label class="form-label">Email</label>
          {{ form.email }}
        </div>
        <div class="col-md-3">
          <label class="form-label">群組角色</label>
          {{ form.role }}
          <div class="form-text">建議 operator；admin 可控全部、viewer 不可控制。</div>
        </div>
      </div>

      <hr class="my-3">
      {{ dev_formset.management_form }}

      <div class="table-responsive">
        <table class="glass-table table table-sm align-middle">
          <thead>
            <tr><th style="width:140px;">包含</th><th>裝置</th><th style="width:180px;">權限</th></tr>
          </thead>
          <tbody>
            {% for d, f in dev_pairs %}
              <tr>
                <td>{{ f.include }} {{ f.device_id }}</td>
                <td>{{ d.display_name|default:d.serial_number }} <small class="text-muted">#{{ d.id }}</small></td>
                <td>{{ f.perm }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="mt-3 d-flex gap-2">
        <button class="btn btn-primary" type="submit">建立邀請</button>
        <a class="btn btn-secondary" href="{% url 'group_detail' group.id %}">回群組</a>
      </div>
    </form>
  </div>
</div>
{% endblock %}
