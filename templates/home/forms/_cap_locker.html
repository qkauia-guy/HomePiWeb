<div class="card mb-3" id="lockerCard" data-cap-id="{{ cap.id }}">
  <div class="card-body">
    <h5 class="card-title mb-3">{{ device.label }}｜{{ cap.name }}</h5>

    <div class="row align-items-start">
      
      <!-- 左邊：電子鎖控制按鈕 -->
      <div class="col-md-5 d-flex flex-wrap gap-3">
        {# 上鎖按鈕 #}
        <button
          class="btn btn-outline-secondary locker-btn"
          id="lockBtn-{{ cap.id }}"
          data-action="lock"
          data-url="{% url 'capability_action' device_id=device.id cap_id=cap.id action='lock' %}"
          data-group="{{ group_id }}"
        >
          <i class="bi bi-lock me-1"></i> 上鎖
        </button>

        {# 開鎖按鈕 #}
        <button
          class="btn btn-outline-success locker-btn"
          id="unlockBtn-{{ cap.id }}"
          data-action="unlock"
          data-url="{% url 'capability_action' device_id=device.id cap_id=cap.id action='unlock' %}"
          data-group="{{ group_id }}"
        >
          <i class="bi bi-unlock me-1"></i> 開鎖
        </button>

        {# 切換按鈕 #}
        <button
          class="btn btn-outline-primary locker-btn"
          id="toggleBtn-{{ cap.id }}"
          data-action="toggle"
          data-url="{% url 'capability_action' device_id=device.id cap_id=cap.id action='toggle' %}"
          data-group="{{ group_id }}"
        >
          <i class="bi bi-arrow-repeat me-1"></i> 切換
        </button>
      </div>

      <!-- 右邊：排程表單 -->
      <div class="col-md-7">
        <form
          id="schedForm-{{ cap.id }}"
          class="row gy-2 gx-2 align-items-end"
          data-create-url="{% url 'create_schedule' %}"
          data-upcoming-url="{% url 'upcoming_schedules' device_id=device.id %}"
          data-slug="{{ cap.slug }}"
        >
          {% csrf_token %}
          <input type="hidden" name="device_id" value="{{ device.id }}">
          <input type="hidden" name="slug" value="{{ cap.slug }}">
          <input type="hidden" name="on_action" value="locker_unlock">
          <input type="hidden" name="off_action" value="locker_lock">

          <div class="col-auto">
            <label class="form-label mb-1">開鎖時間</label>
            <input type="datetime-local" name="on_at_local" class="form-control form-control-sm">
          </div>

          <div class="col-auto">
            <label class="form-label mb-1">上鎖時間</label>
            <input type="datetime-local" name="off_at_local" class="form-control form-control-sm">
          </div>

          <div class="col-auto d-flex gap-2">
            <button type="button" class="btn btn-success btn-sm" data-submit-both="#schedForm-{{ cap.id }}">排程時間</button>
          </div>

          <div class="col-12">
            <small class="text-muted">時間使用你的瀏覽器時區（後端自動轉 UTC 存）。</small>
            <div class="text-success small d-none mt-1" id="schedMsg-{{ cap.id }}"></div>
            <div class="text-danger small d-none mt-1" id="schedErr-{{ cap.id }}"></div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>


