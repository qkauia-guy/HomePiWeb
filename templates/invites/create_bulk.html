{% extends "base.html" %}
{% block content %}
<h3>批次建立邀請</h3>
<p class="text-muted">可一次為多台裝置建立邀請連結；每台裝置各一張、單次使用。</p>

<div class="mb-2"><strong>群組：</strong>{{ group.name }}</div>

<form method="post" class="mt-3">
  {% csrf_token %}

  <div class="mb-3">
    <label class="form-label">選擇裝置（可多選）</label>
    <div class="row row-cols-1 row-cols-md-2 g-2">
      {% for d in devices %}
      <div class="col">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" name="device_ids" value="{{ d.id }}" id="dev{{ d.id }}">
          <label class="form-check-label" for="dev{{ d.id }}">
            {{ d.display_name|default:d.serial_number }}
            <small class="text-muted">(#{{ d.id }})</small>
          </label>
        </div>
      </div>
      {% empty %}
      <div class="text-muted">此群組尚無裝置。</div>
      {% endfor %}
    </div>
    <div class="form-text">至少勾選一台。</div>
  </div>

  <div class="mb-3">
    <label class="form-label">限定 Email（可留空）</label>
    <input type="email" name="email" class="form-control" placeholder="someone@example.com" value="{{ request.POST.email }}">
  </div>

  <div class="mb-3">
    <label class="form-label">群組角色</label>
    <select name="role" class="form-select" required>
      <option value="operator" selected>operator（可操作裝置，不可改環境/不可群管）</option>
      <option value="viewer">viewer（僅查看）</option>
    </select>
  </div>

  <div class="mb-3">
    <label class="form-label">有效天數</label>
    <input type="number" name="days" class="form-control" value="{{ request.POST.days|default:7 }}" min="1" max="30">
  </div>

  <div class="d-flex gap-2">
    <button class="btn btn-primary" type="submit">建立</button>
    <a href="{% url 'group_detail' group.id %}" class="btn btn-secondary">返回群組</a>
  </div>
</form>
{% endblock %}
