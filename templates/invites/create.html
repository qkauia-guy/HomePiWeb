{% extends "base.html" %}
{% block content %}
<h3>建立邀請</h3>
<p class="text-muted">此連結僅能使用一次。預設角色為 <code>operator</code>；可選擇限制 Email 與有效天數。</p>

{# 顯示目前群組與裝置（請在 view 傳入 group、device） #}
<div class="card mb-3">
  <div class="card-body">
    <div><strong>群組：</strong>{{ group.name }}</div>
    <div>
      <strong>裝置：</strong>
      {{ device.display_name|default:device.serial_number }}
      <small class="text-muted">(#{{ device.id }})</small>
    </div>
  </div>
</div>

<form method="post" class="mt-3">
  {% csrf_token %}

  <div class="mb-3">
    <label class="form-label">限定 Email（可留空）</label>
    <input type="email" name="email" class="form-control" placeholder="someone@example.com" value="{{ request.POST.email }}">
    <div class="form-text">若填寫，僅此 Email 可使用邀請；留空則誰先使用就是誰。</div>
  </div>

  <div class="mb-3">
    <label class="form-label">群組角色</label>
    <select name="role" class="form-select" required>
      <option value="operator" {% if request.POST.role == "operator" or not request.POST.role %}selected{% endif %}>
        operator（可操作裝置，不可改環境/不可群管）
      </option>
      <option value="viewer" {% if request.POST.role == "viewer" %}selected{% endif %}>
        viewer（僅查看）
      </option>
    </select>
  </div>

  <div class="mb-3">
    <label class="form-label">有效天數</label>
    <input type="number" name="days" class="form-control" value="{{ request.POST.days|default:7 }}" min="1" max="30">
  </div>

  <div class="d-flex gap-2">
    <button class="btn btn-primary" type="submit">建立</button>
    <a href="{% url 'group_detail' group.id %}" class="btn btn-secondary">返回群組</a>
  </div>
</form>
{% endblock %}
